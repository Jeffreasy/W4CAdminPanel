(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[340],{3368:function(e,t,r){Promise.resolve().then(r.bind(r,7653))},7653:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return c}});var s=r(3827),a=r(4090),o=r(7907),i=r(3779),n=r(8714),l=r(7546),d=r(8009);function c(e){let{params:t}=e,{user:r,isLoading:c}=(0,i.a)(),u=(0,o.useRouter)(),g=(0,n.createClientComponentClient)(),[m,h]=(0,a.useState)(null),[x,p]=(0,a.useState)(!0),[b,f]=(0,a.useState)(null),[y,v]=(0,a.useState)(!1),[j,w]=(0,a.useState)(null),[N,k]=(0,a.useState)(""),[C,S]=(0,a.useState)(""),[P,A]=(0,a.useState)(""),[E,_]=(0,a.useState)(""),[M,F]=(0,a.useState)(!0),[I,q]=(0,a.useState)(""),[L,z]=(0,a.useState)([]),[B,D]=(0,a.useState)(null),[R,W]=(0,a.useState)(null);(0,a.useEffect)(()=>{async function e(){try{p(!0),f(null);let{data:e,error:r}=await g.from("products").select("*").eq("id",t.id).single();if(r){if("PGRST116"===r.code)throw Error("Product not found");throw r}h(e),k(e.name||""),S(e.description||""),A(e.price?e.price.toString():""),_(e.stock?e.stock.toString():""),F(!!e.is_active),q(e.image||""),z(Array.isArray(e.images)?e.images.filter(t=>t!==e.image&&t):[]);let{data:s}=await g.from("products").select("id, name").order("name");if(s&&s.length>0){let e=s.findIndex(e=>e.id===t.id);e>0?D(s[e-1].id):D(null),e<s.length-1?W(s[e+1].id):W(null)}}catch(e){console.error("Error fetching product details:",e),f(e.message||"Failed to load product details")}finally{p(!1)}}r&&t.id&&e()},[r,t.id,g]);let O=async e=>{e.preventDefault();try{if(v(!0),f(null),w(null),!N.trim())throw Error("Product name is required");if(!C.trim())throw Error("Description is required");if(!P||0>=parseFloat(P))throw Error("Price must be greater than zero");if(!E||0>parseInt(E))throw Error("Stock cannot be negative");if(!I.trim())throw Error("Main image is required");let e={name:N,description:C,price:parseFloat(P),stock:parseInt(E),is_active:M,image:I,images:[I,...L.filter(e=>e)],updated_at:new Date().toISOString()},{error:r}=await g.from("products").update(e).eq("id",t.id);if(r)throw r;d.Am.success("Product updated successfully"),w("Product updated successfully"),h({...m,...e}),setTimeout(()=>{v(!1)},1e3)}catch(e){console.error("Error updating product:",e),f(e.message||"Failed to update product"),d.Am.error(e.message||"Failed to update product"),v(!1)}},Z=e=>{z(L.filter(t=>t!==e)),d.Am.success("Image removed")},H=(0,a.useCallback)(e=>{q(e.public_id),d.Am.success("Main image uploaded successfully")},[]),T=(0,a.useCallback)(e=>{let t=e.public_id;z(e=>[...e,t]),d.Am.success("Additional image uploaded successfully")},[]),U=e=>{I&&I!==e&&z(t=>[...t.filter(t=>t!==e),I]),q(e),z(t=>t.filter(t=>t!==e)),d.Am.success("Main image updated")};return c||x?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[80vh]",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-t-4 border-blue-500 border-solid rounded-full animate-spin mb-4"}),(0,s.jsx)("p",{className:"text-xl text-gray-300",children:c?"Checking authentication...":"Loading product details..."})]}):r?m||x?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-300",children:["Edit Product: ",N]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)("button",{onClick:()=>u.push("/dashboard/products"),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-white text-sm transition-colors shadow-md hover:shadow-lg hover:-translate-y-0.5 transform duration-200",children:"Back to Products"})})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("button",{onClick:()=>B&&u.push("/dashboard/products/".concat(B)),disabled:!B,className:"px-3 py-1.5 rounded text-sm transition-colors ".concat(B?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"),children:(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Previous Product"]})}),(0,s.jsx)("span",{className:"text-gray-400 text-sm",children:!x&&m&&(0,s.jsxs)(s.Fragment,{children:["ID: ",(0,s.jsx)("span",{className:"text-gray-300 font-mono",children:t.id})]})}),(0,s.jsx)("button",{onClick:()=>R&&u.push("/dashboard/products/".concat(R)),disabled:!R,className:"px-3 py-1.5 rounded text-sm transition-colors ".concat(R?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"),children:(0,s.jsxs)("span",{className:"flex items-center",children:["Next Product",(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]}),b&&(0,s.jsx)("div",{className:"bg-red-500/10 border border-red-500/30 p-4 rounded-lg text-red-400 animate-pulse",children:b}),j&&(0,s.jsx)("div",{className:"bg-green-500/10 border border-green-500/30 p-4 rounded-lg text-green-400",children:j}),(0,s.jsx)("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 p-6 rounded-xl shadow-lg border border-gray-700/50",children:(0,s.jsxs)("form",{onSubmit:O,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Product Name"}),(0,s.jsx)("input",{type:"text",value:N,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"Enter product name",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Description"}),(0,s.jsx)("textarea",{value:C,onChange:e=>S(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500/50 min-h-[150px]",placeholder:"Describe your product",required:!0})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Price (â‚¬)"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:P,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"0.00",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Stock"}),(0,s.jsx)("input",{type:"number",min:"0",value:E,onChange:e=>_(e.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500/50",placeholder:"0",required:!0})]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer select-none",children:[(0,s.jsx)("input",{type:"checkbox",checked:M,onChange:e=>F(e.target.checked),className:"w-4 h-4 bg-gray-700 border-gray-600 rounded focus:ring-blue-500 text-blue-600 focus:ring-offset-gray-800"}),(0,s.jsx)("span",{children:"Active (visible in shop)"})]})})]}),(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium mb-3",children:"Main Product Image"}),I?(0,s.jsxs)("div",{className:"relative rounded-lg overflow-hidden border-2 border-gray-700 h-64 group bg-gray-900/50",children:[(0,s.jsx)(l.bz,{src:I,alt:"Main product image",fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",className:"object-contain transition-transform duration-300 group-hover:scale-105 p-2"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 flex items-center justify-center group-hover:bg-opacity-50 transition-all duration-300",children:(0,s.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex space-x-2",children:[(0,s.jsx)(l.ZF,{uploadPreset:"product_images",onSuccess:e=>{e.info&&H(e.info)},children:e=>{let{open:t}=e;return(0,s.jsx)("button",{type:"button",onClick:()=>t(),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-white text-sm",children:"Replace"})}}),(0,s.jsx)("button",{type:"button",onClick:()=>q(""),className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-white text-sm",children:"Remove"})]})})]}):(0,s.jsx)(l.ZF,{uploadPreset:"product_images",onSuccess:e=>{e.info&&H(e.info)},children:e=>{let{open:t}=e;return(0,s.jsxs)("button",{type:"button",onClick:()=>t(),className:"w-full h-64 border-2 border-dashed border-gray-600 rounded-lg flex flex-col items-center justify-center bg-gray-700/30 hover:bg-gray-700/50 transition-colors duration-200",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-12 w-12 text-gray-400 mb-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,s.jsx)("p",{className:"text-gray-400 text-sm mb-1",children:"Upload main product image"}),(0,s.jsx)("p",{className:"text-gray-500 text-xs",children:"Click to browse"})]})}}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-3",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Additional Images"}),(0,s.jsx)(l.ZF,{uploadPreset:"product_images",onSuccess:e=>{e.info&&T(e.info)},children:e=>{let{open:t}=e;return(0,s.jsx)("button",{type:"button",onClick:()=>t(),className:"text-xs px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded text-white",children:"Add Image"})}})]}),L.length>0?(0,s.jsx)("div",{className:"grid grid-cols-3 gap-3",children:L.map((e,t)=>(0,s.jsxs)("div",{className:"relative group rounded-lg overflow-hidden border border-gray-700 h-24 bg-gray-900/50",children:[(0,s.jsx)(l.bz,{src:e,alt:"Additional image ".concat(t+1),fill:!0,sizes:"(max-width: 768px) 33vw, 100px",className:"object-contain transition-all duration-200 group-hover:opacity-80 p-1"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 flex items-center justify-center group-hover:bg-opacity-50 transition-all duration-300",children:(0,s.jsxs)("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex space-x-1",children:[(0,s.jsx)("button",{type:"button",onClick:()=>U(e),className:"px-2 py-1 bg-green-600 hover:bg-green-700 rounded text-white text-xs",children:"Set Main"}),(0,s.jsx)("button",{type:"button",onClick:()=>Z(e),className:"px-2 py-1 bg-red-600 hover:bg-red-700 rounded text-white text-xs",children:"Remove"})]})})]},t))}):(0,s.jsx)("div",{className:"text-center bg-gray-800/50 p-4 rounded-lg border border-gray-700/50",children:(0,s.jsx)("p",{className:"text-gray-500 text-sm",children:"No additional images"})})]})]})})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-6 border-t border-gray-700 mt-6",children:[(0,s.jsx)("button",{type:"button",onClick:()=>u.push("/dashboard/products"),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-white transition-colors shadow-md",children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:y,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-white transition-colors shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:y?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsxs)("svg",{className:"animate-spin h-4 w-4 mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving Changes..."]}):"Save Changes"})]})]})})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-300",children:"Product Not Found"}),(0,s.jsx)("button",{onClick:()=>u.push("/dashboard/products"),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-white text-sm transition-colors shadow-md hover:shadow-lg hover:-translate-y-0.5 transform duration-200",children:"Back to Products"})]}),(0,s.jsx)("div",{className:"bg-red-500/10 border border-red-500/30 p-4 rounded-lg text-red-400 animate-pulse",children:b||"Product not found or you do not have permission to view it."})]}):(u.push("/login"),null)}},3779:function(e,t,r){"use strict";r.d(t,{H:function(){return l},a:function(){return d}});var s=r(3827),a=r(4090),o=r(7907),i=r(8714);let n=(0,a.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,a.useState)(null),[d,c]=(0,a.useState)(!0),u=(0,o.useRouter)(),g=(0,i.createClientComponentClient)();(0,a.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await g.auth.getUser();l(e)}catch(e){console.error("Error getting user:",e)}finally{c(!1)}})();let{data:{subscription:e}}=g.auth.onAuthStateChange((e,t)=>{var r;l(null!==(r=null==t?void 0:t.user)&&void 0!==r?r:null),c(!1)});return()=>{e.unsubscribe()}},[g,u]);let m=async(e,t)=>{try{let{data:r,error:s}=await g.auth.signInWithPassword({email:e,password:t});if(s)throw s;l(r.user);let{data:{session:a}}=await g.auth.getSession();(null==a?void 0:a.user)&&u.push("/dashboard")}catch(e){throw console.error("Sign in error:",e),e}},h=async()=>{await g.auth.signOut(),u.push("/"),u.refresh()};return(0,s.jsx)(n.Provider,{value:{user:r,isLoading:d,signIn:m,signOut:h},children:t})},d=()=>{let e=(0,a.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[676,714,9,546,971,69,744],function(){return e(e.s=3368)}),_N_E=e.O()}]);