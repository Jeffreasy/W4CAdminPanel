(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[190],{2846:function(e,t,s){Promise.resolve().then(s.bind(s,9045))},9045:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var r=s(3827),a=s(4090),d=s(7907),l=s(3779),o=s(8714),n=s(2007),i=s(7546),c=s(8009);function m(e){let{params:t}=e,{user:s,isLoading:m}=(0,l.a)(),x=(0,d.useRouter)(),u=(0,o.createClientComponentClient)(),[h,g]=(0,a.useState)(null),[p,b]=(0,a.useState)([]),[y,f]=(0,a.useState)(!0),[j,w]=(0,a.useState)(null),[v,N]=(0,a.useState)(!1),[_,k]=(0,a.useState)(null),[C,S]=(0,a.useState)(null);async function P(e){try{N(!0);let{error:s}=await u.from("orders").update({status:e,updated_at:new Date().toISOString()}).eq("id",t.id);if(s)throw s;h&&g({...h,status:e,updated_at:new Date().toISOString()}),c.Am.success("Order status updated to ".concat(e))}catch(e){console.error("Error updating order status:",e),c.Am.error("Failed to update order status: "+e.message)}finally{N(!1)}}async function O(){try{N(!0);let e=await fetch("/api/orders/send-emails-wfc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderId:t.id,customer:{name:"".concat(null==h?void 0:h.customer_first_name," ").concat(null==h?void 0:h.customer_last_name),email:null==h?void 0:h.customer_email,address:null==h?void 0:h.customer_address,city:null==h?void 0:h.customer_city,postalCode:null==h?void 0:h.customer_postal_code,country:null==h?void 0:h.customer_country}})});if(!e.ok){let t=await e.json();throw Error(t.message||"Failed to send emails")}let{error:s}=await u.from("orders").update({emails_sent:!0}).eq("id",t.id);if(s)throw s;h&&g({...h,emails_sent:!0}),c.Am.success("Confirmation emails sent successfully")}catch(e){console.error("Error sending emails:",e),c.Am.error("Failed to send emails: "+e.message)}finally{N(!1)}}(0,a.useEffect)(()=>{async function e(){try{f(!0),w(null);let{data:e,error:s}=await u.from("orders").select("*").eq("id",t.id).single();if(s)throw s;let{data:r,error:a}=await u.from("order_items").select("*").eq("order_id",t.id);if(a)throw a;let d=await Promise.all(r.map(async e=>{let{data:t,error:s}=await u.from("products").select("name, image").eq("id",e.product_id).single();return s?(console.error("Error fetching product:",s),{...e,product:{name:"Unknown Product",image:""}}):{...e,product:t}})),{data:l,error:o}=await u.from("orders").select("id, order_number").order("created_at",{ascending:!1});if(o)throw o;if(l&&l.length>0){let e=l.findIndex(e=>e.id===t.id);e>0?k(l[e-1].id):k(null),e<l.length-1?S(l[e+1].id):S(null)}g(e),b(d)}catch(e){console.error("Error fetching order details:",e),w(e.message||"Failed to load order details"),c.Am.error("Failed to load order details")}finally{f(!1)}}s&&t.id&&e()},[s,t.id,u]);let E=(0,a.useMemo)(()=>p.length?{totalItems:p.length,totalQuantity:p.reduce((e,t)=>e+t.quantity,0)}:{totalItems:0,totalQuantity:0},[p]);return m||y?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-[80vh]",children:[(0,r.jsx)("div",{className:"w-12 h-12 border-4 border-t-blue-500 border-gray-700 rounded-full animate-spin mb-4"}),(0,r.jsx)("p",{className:"text-gray-300 text-lg",children:m?"Checking authentication...":"Loading order details..."})]}):s?h?(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[(0,r.jsxs)("h1",{className:"text-xl sm:text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-300",children:["Order #",h.order_number]}),(0,r.jsx)("button",{onClick:()=>x.push("/dashboard/orders"),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-white text-sm transition-colors shadow-md hover:shadow-lg hover:-translate-y-0.5 transform duration-200",children:"Back to Orders"})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("button",{onClick:()=>_&&x.push("/dashboard/orders/".concat(_)),disabled:!_,className:"px-3 py-2 rounded text-sm transition-colors ".concat(_?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"),children:(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Previous"]})}),(0,r.jsx)("span",{className:"text-gray-400 text-xs sm:text-sm",children:!y&&h&&(0,r.jsxs)(r.Fragment,{children:["Order ID: ",(0,r.jsx)("span",{className:"text-gray-300 font-mono text-xs",children:t.id})]})}),(0,r.jsx)("button",{onClick:()=>C&&x.push("/dashboard/orders/".concat(C)),disabled:!C,className:"px-3 py-2 rounded text-sm transition-colors ".concat(C?"bg-gray-700 hover:bg-gray-600 text-white":"bg-gray-800 text-gray-500 cursor-not-allowed"),children:(0,r.jsxs)("span",{className:"flex items-center",children:["Next",(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]}),j&&(0,r.jsx)("div",{className:"bg-red-500/10 border border-red-500/30 p-4 rounded-lg text-red-400 animate-pulse",children:j}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-5",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 p-4 sm:p-6 rounded-xl shadow-lg md:col-span-2 border border-gray-700/50",children:[(0,r.jsx)("h2",{className:"text-lg sm:text-xl font-bold mb-4 sm:mb-6 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-300",children:"Order Details"}),(0,r.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-y-5 gap-x-3 sm:gap-x-4 mb-6 sm:mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Date"}),(0,r.jsx)("p",{className:"font-medium text-sm sm:text-base",children:(0,n.WU)(new Date(h.created_at),"MMMM dd, yyyy")}),(0,r.jsx)("p",{className:"text-xs text-gray-400",children:(0,n.WU)(new Date(h.created_at),"HH:mm:ss")})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Status"}),(0,r.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("paid"===h.status?"bg-green-500/20 text-green-400 border border-green-500/30":"shipped"===h.status?"bg-blue-500/20 text-blue-400 border border-blue-500/30":"completed"===h.status?"bg-purple-500/20 text-purple-400 border border-purple-500/30":"cancelled"===h.status?"bg-red-500/20 text-red-400 border border-red-500/30":"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30"),children:h.status.charAt(0).toUpperCase()+h.status.slice(1)})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Total Amount"}),(0,r.jsxs)("p",{className:"text-lg sm:text-xl font-bold text-amber-500",children:["€",Number(h.total_amount).toFixed(2)]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Emails"}),(0,r.jsxs)("div",{className:"flex items-center gap-2 mt-1",children:[(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(h.emails_sent?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-red-500/20 text-red-400 border border-red-500/30"),children:h.emails_sent?"Sent":"Not Sent"}),!h.emails_sent&&(0,r.jsx)("button",{onClick:O,disabled:v,className:"px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-white text-xs transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Sending...":"Send Now"})]})]})]}),(0,r.jsxs)("div",{className:"border-t border-gray-700 my-4 sm:my-6 pt-4 sm:pt-6",children:[(0,r.jsxs)("h3",{className:"text-base sm:text-lg font-medium mb-3 sm:mb-4",children:["Order Items (",E.totalItems," items, ",E.totalQuantity," total quantities)"]}),0===p.length?(0,r.jsx)("div",{className:"bg-gray-800/50 p-4 rounded-lg border border-gray-700/50 text-center",children:(0,r.jsx)("p",{className:"text-gray-400",children:"No items found for this order"})}):(0,r.jsx)("div",{className:"space-y-3 sm:space-y-4",children:p.map(e=>{var t,s,a;return(0,r.jsxs)("div",{className:"bg-gray-800/50 p-3 sm:p-4 rounded-lg border border-gray-700/50 flex flex-col sm:flex-row items-center gap-3 sm:gap-4",children:[(0,r.jsx)("div",{className:"w-20 h-20 sm:w-24 sm:h-24 relative bg-gray-900/50 rounded-lg overflow-hidden flex-shrink-0",children:(null===(t=e.product)||void 0===t?void 0:t.image)?(0,r.jsx)(i.bz,{src:e.product.image,alt:(null===(s=e.product)||void 0===s?void 0:s.name)||"Product",fill:!0,sizes:"(max-width: 768px) 80px, 100px",className:"object-contain p-2"}):(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 sm:h-10 sm:w-10 text-gray-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})}),(0,r.jsxs)("div",{className:"flex-grow text-center sm:text-left",children:[(0,r.jsx)("h4",{className:"font-medium text-sm sm:text-base line-clamp-2",children:(null===(a=e.product)||void 0===a?void 0:a.name)||"Unknown Product"}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-center sm:justify-start gap-2 sm:gap-4 mt-2",children:[(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-gray-400",children:["Quantity: ",(0,r.jsx)("span",{className:"text-white font-medium",children:e.quantity})]}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-gray-400",children:["Price: ",(0,r.jsxs)("span",{className:"text-amber-500 font-medium",children:["€",Number(e.price).toFixed(2)]})]}),(0,r.jsxs)("p",{className:"text-xs sm:text-sm text-gray-400",children:["Subtotal: ",(0,r.jsxs)("span",{className:"text-amber-500 font-medium",children:["€",(e.quantity*e.price).toFixed(2)]})]})]})]}),e.product_id&&(0,r.jsx)("button",{onClick:()=>x.push("/dashboard/products/".concat(e.product_id)),className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-white text-xs transition-colors shadow-sm hover:shadow-md flex-shrink-0",children:"View Product"})]},e.id)})})]}),(0,r.jsx)("div",{className:"mt-6 border-t border-gray-700 pt-6",children:(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row items-center sm:justify-end gap-3",children:[(0,r.jsx)("div",{className:"w-full sm:w-auto order-2 sm:order-1",children:(0,r.jsx)("button",{onClick:()=>x.push("/dashboard/orders"),className:"w-full sm:w-auto px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded text-white transition-colors shadow-md",children:"Back to Orders"})}),(0,r.jsx)("div",{className:"w-full sm:w-auto order-1 sm:order-2",children:(0,r.jsxs)("select",{value:h.status,onChange:e=>P(e.target.value),disabled:v,className:"w-full sm:w-auto px-3 py-2 bg-gray-700 border border-gray-600 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500/50 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,r.jsx)("option",{value:"pending",children:"Pending"}),(0,r.jsx)("option",{value:"paid",children:"Paid"}),(0,r.jsx)("option",{value:"shipped",children:"Shipped"}),(0,r.jsx)("option",{value:"completed",children:"Completed"}),(0,r.jsx)("option",{value:"cancelled",children:"Cancelled"})]})})]})})]}),(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 p-4 sm:p-6 rounded-xl shadow-lg border border-gray-700/50",children:[(0,r.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-3 sm:mb-4 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-300",children:"Customer Details"}),(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Name"}),(0,r.jsxs)("p",{className:"font-medium text-sm sm:text-base",children:[h.customer_first_name," ",h.customer_last_name]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Email"}),(0,r.jsx)("p",{className:"font-medium text-sm sm:text-base break-all",children:h.customer_email})]}),(0,r.jsxs)("div",{className:"border-t border-gray-700 pt-3 sm:pt-4",children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Shipping Address"}),(0,r.jsx)("p",{className:"font-medium text-sm sm:text-base",children:h.customer_address}),(0,r.jsxs)("p",{className:"text-sm",children:[h.customer_postal_code,", ",h.customer_city]}),(0,r.jsx)("p",{className:"text-sm",children:h.customer_country})]})]})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-800 to-gray-900 p-4 sm:p-6 rounded-xl shadow-lg border border-gray-700/50",children:[(0,r.jsx)("h3",{className:"text-base sm:text-lg font-medium mb-3 sm:mb-4 bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-300",children:"Payment Information"}),(0,r.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Status"}),(0,r.jsx)("p",{className:"font-medium",children:(0,r.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("paid"===h.status||"completed"===h.status||"shipped"===h.status?"bg-green-500/20 text-green-400 border border-green-500/30":"cancelled"===h.status?"bg-red-500/20 text-red-400 border border-red-500/30":"bg-yellow-500/20 text-yellow-400 border border-yellow-500/30"),children:"paid"===h.status||"completed"===h.status||"shipped"===h.status?"Payment Completed":"cancelled"===h.status?"Payment Cancelled":"Payment Pending"})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Total Amount"}),(0,r.jsxs)("p",{className:"text-lg sm:text-xl font-bold text-amber-500",children:["€",Number(h.total_amount).toFixed(2)]})]}),h.payment_reference&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-gray-400 text-xs sm:text-sm mb-1",children:"Payment Reference"}),(0,r.jsx)("p",{className:"font-mono text-xs sm:text-sm break-all bg-gray-900/50 p-2 rounded border border-gray-700",children:h.payment_reference})]})]})]})]})]})]}):(0,r.jsxs)("div",{className:"space-y-5",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-300",children:"Order Not Found"}),(0,r.jsx)("button",{onClick:()=>x.push("/dashboard/orders"),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-md text-white text-sm transition-colors shadow-md hover:shadow-lg hover:-translate-y-0.5 transform duration-200",children:"Back to Orders"})]}),(0,r.jsx)("div",{className:"bg-red-500/10 border border-red-500/30 p-4 rounded-lg text-red-400 animate-pulse",children:j||"Order not found or you do not have permission to view it."})]}):(x.push("/login"),null)}},3779:function(e,t,s){"use strict";s.d(t,{H:function(){return n},a:function(){return i}});var r=s(3827),a=s(4090),d=s(7907),l=s(8714);let o=(0,a.createContext)(void 0),n=e=>{let{children:t}=e,[s,n]=(0,a.useState)(null),[i,c]=(0,a.useState)(!0),m=(0,d.useRouter)(),x=(0,l.createClientComponentClient)();(0,a.useEffect)(()=>{(async()=>{try{let{data:{user:e}}=await x.auth.getUser();n(e)}catch(e){console.error("Error getting user:",e)}finally{c(!1)}})();let{data:{subscription:e}}=x.auth.onAuthStateChange((e,t)=>{var s;n(null!==(s=null==t?void 0:t.user)&&void 0!==s?s:null),c(!1)});return()=>{e.unsubscribe()}},[x,m]);let u=async(e,t)=>{try{let{data:s,error:r}=await x.auth.signInWithPassword({email:e,password:t});if(r)throw r;n(s.user);let{data:{session:a}}=await x.auth.getSession();(null==a?void 0:a.user)&&m.push("/dashboard")}catch(e){throw console.error("Sign in error:",e),e}},h=async()=>{await x.auth.signOut(),m.push("/"),m.refresh()};return(0,r.jsx)(o.Provider,{value:{user:s,isLoading:i,signIn:u,signOut:h},children:t})},i=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[676,714,9,546,7,971,69,744],function(){return e(e.s=2846)}),_N_E=e.O()}]);